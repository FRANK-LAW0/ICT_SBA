# Sports Day Management System
This is a web application for inputting, managing, reading and tracking sports day events, athletes and results. It is built by using Python with the `flask` and `sqlite3` libraries 


## 1. Objective
- Digitize sports day process

### 1.1 Paper Transfer and Manual Ranking

  - Current Process: 
    1. The result of athletes in each event is recorded on paper by sports day helpers
    2. The paper is transferred to the helpers who deal with the result
    3. The result is inputted into an excel file manually
    4. Use functions in excel to calculate ranking of each event

  - Problem:
    - Time-consuming for transferring the paper 
    - Entering the same data twice
      - 1st: The result is recorded by helpers at the sports venues
      - 2nd: The same result is inputted by helpers into the excel file
    - Easily to make errors while inputting data (input the wrong name/result)

  - Solution:
    - This system allows helpers at the sports venues to input the data for once only
    - The time for transferring the data can be reduced
    - The results are stored in database
    - Algorithm is used for ranking the results in each event automatically
    - Data validation is applied for inputted data

### 1.2 Display Board

  - Current Process:
    1. A real display board is used to display athletes' results of each event
    2. Names and results needed to be copied to the board manually

  - Problem:
    - The visibility of the board is limited. Athletes need to go to see the board in person
    - Easily to make errors while copying data (copy the wrong name/result)

  - Solution:
    - This system allows authenticated users (teachers and students in the school) to view the results and ranks online


## 2. Features

### 2.1 Authentication and Data Security
- Two roles (Admin, User) with different permissions
- User roles are configured and managed directly by database administrator
- Only database administrator and sports day helpers are assigned the Admin role, others are assigned the User role

| Feature | Admin | User |
|:-------:|:-----:|:----:|
| View Athletes | ✅ | ❌ |
| View Events | ✅ | ✅ |
| View Results | ✅ | ✅ |
| Manage Results | ✅ | ❌ |
| Manage Events | ✅ | ❌ |
| Filter Data | ✅ | ✅ |

- Password hashing with `werkzeug.security` library (suggested by AI)
- Protect routes with login requirements

### 2.2 Lightweight Database `sqlite3`
- Serverless
- No setup or installation is required other than Python library
- Optimized for low to medium traffic

### 2.3 Athlete Management
- ID, name, house, gender and grade tracking
- Search by multiple criteria simultaneously
- Admin-only access to add/edit/delete athlete information
- Data validation for input

### 2.4 Event Management
- Grouped by ID, name, gender, grade
- Event status tracking
- Search by multiple criteria simultaneously

### 2.5 Result System
- Result tracking and ranking
- Automatic ranking calculation (time-based and distance-based events)
- Search by multiple criteria simultaneously
- Data validation for input

### 2.6 Mobile View
- Hamburger navigation menu for mobile devices

### 2.7 Sample data generation
- Sample data is generated by `faker` and `random` libraries

## 3. Database

### 3.1 Schema
![Schema](image/00_Schema.jpeg)

### 3.2 ER Diagram
![ER_diagram](image/00_ER_diagram.jpeg)

### 3.3 Core Tables

#### 1. User Table
```sql
CREATE TABLE Users (
    username TEXT PRIMARY KEY,
    password TEXT NOT NULL,
    role TEXT NOT NULL CHECK(role IN('admin','user'))
);        
```

#### 2. Events Table
```sql
CREATE TABLE Events (
    event_id TEXT PRIMARY KEY,
    event TEXT NOT NULL,
    sex TEXT NOT NULL CHECK(sex IN('Boys','Girls')),
    grade TEXT NOT NULL CHECK(grade IN('A','B','C')),
    status TEXT NOT NULL CHECK(status IN('Completed', 'Not yet started'))
);    
```

#### 3. Athletes Table
```sql      
CREATE TABLE Athletes (
    athlete_id TEXT PRIMARY KEY,
    name TEXT NOT NULL,
    house TEXT NOT NULL,
    sex TEXT NOT NULL CHECK(sex IN('Boys','Girls')),
    grade TEXT NOT NULL CHECK(grade IN('A','B','C'))
);    
```

#### 4. Results Table
```sql
CREATE TABLE results (
    result_id INTEGER PRIMARY KEY AUTOINCREMENT,
    athlete_id TEXT NOT NULL REFERENCES Athletes(athlete_id),
    event_id TEXT NOT NULL REFERENCES Events(event_id),
    result REAL,
    status TEXT NOT NULL CHECK(status IN('Completed', 'Not yet started', 'Disqualified'))
);
```

#### Key Features
- Foreign key constraints maintain data consistency for referential integrity
- CHECK constraints enforce valid values


## 4. Algorithms

### 4.1 Ranking Algorithm
```python
def invalid_ranking(r):
    # Separate valid and invalid results
    return (r['result'] is None) or (r['status'] in ('Disqualified', 'Not yet started'))
       
is_time_based = 'meters' in row['event'].lower()
valid = [res for res in results['result'] if not invalid_ranking(res)]
invalid = [res for res in results['result'] if invalid_ranking(res)]

if is_time_based:
    sorted_results = sorted(valid, key=lambda r: r['result']) # Lower time is better
else:
    sorted_results = sorted(valid, key=lambda r: -r['result']) # Higher score is better

# Calculate ranks
current_rank = 1
for i, result in enumerate(sorted_results):
    if i > 0 and result['result'] == sorted_results[i-1]['result']:
        result['rank'] = current_rank  # Tie handling
    else:
        current_rank = i + 1
        result['rank'] = current_rank

```

#### Key Features
- Automatically identify time-based events by checking for "meters" in event name
- Athletes with the same results share the same rank
- Disqualified or incomplete results are excluded from ranking

### 4.2 Data Grouping and Organization
```python
# Group results by event for display
grouped = {}
for row in all_rows:
    key = (row['event_id'], row['event'], f"{row['event_sex']} {row['event_grade']}")
    if key not in grouped:
        grouped[key] = {'event_status': row['event_status'], 'result': []}
```


## 5. Database + Algorithm

### 5.1 Validation
```python

# Get required attributes from different tables 
athlete = db.execute(
    "SELECT * FROM Athletes WHERE athlete_id=?", (ath_id,)
).fetchone()
event = db.execute(
    "SELECT * FROM Events WHERE event_id=?", (ev_id,)
).fetchone()

# Validation
if not athlete:
    flash("Athlete ID not found", "error")
elif not event:
    flash("Event ID not found", "error")
elif athlete['sex'] != event['sex'] or athlete['grade'] != event['grade']:
    flash("Sex/grade mismatch between athlete & event", "error")
else:
    event_status = event['status']
    if event_status == 'Not yet started':
        flash("Cannot add result to an event that has not started", "error")
        return redirect(url_for('add_result'))
```

### 5.2 Multiple Criteria Filtering
```python
query = "SELECT * FROM Athletes"
where_filters = []
params = []

# Add conditions to where_filters
if athlete_id:
    where_filters.append("athlete_id=?")
    params.append(athlete_id)
if house:
    where_filters.append("house=?")
    params.append(house)
if sex:
    where_filters.append("sex=?")
    params.append(sex)
if grade:
    where_filters.append("grade=?")
    params.append(grade)

# Join all the conditions
if where_filters:
    query += " WHERE " + " AND ".join(where_filters)

# Get the data that fulfill all conditions 
athletes = db.execute(query, params).fetchall()
```
- Drop-down lists are used for some fields in filter functions for data validation 
![image](image/07_athlete_filter_list.jpeg)


## 6. Installation

1. Clone or download the project files
2. Set up Python virtual environment
3. Install dependencies from requirements.txt
   ```bash
   pip install -r requirements.txt
   python app.py
   ```
4. Default username and password
   - **Admin**
     - Username: `admin`
     - Password: `adminpass`
     - Permissions: Full system access
   - **User**
     - Username: `user`
     - Password: `userpass`
     - Permissions: Read-only access


## 7. Project Structure

```text
SBA/
├── app.py                 
├── fake_info.py           
├── requirements.txt          
├── build/                 
│   ├── static/
│   │   ├── css/          
│   │   └── js/         
│   └── *.html 
└── sports_day.db          
```


## 8. Testing

### 8.1 Testing Methodology
- Manual functional testing with predefined test cases
- Role-based testing (Admin vs User)
- Security testing for authentication and authorization

### 8.2 Test Data
- Total Athletes: 120 (generated by `fake_info.py`)
- Total Events: 62
- Total Results: 240 (2 per athlete)

### 8.3 Test Result

#### i. Login Page
| Test Case | Expected Result | Actual Result | Screenshot |
|:----------|:----------------|:--------------|:-----------|
| Invalid Login | Error message displayed | As expected | ![image](image/02_invalid_login.jpeg) |
| User Login | Only authorized webpages are shown in navigation bar | As expected | ![image](image/03_user_home.jpeg) |
| Admin Login | All webpages are shown in navigation bar | As expected | ![image](image/04_admin_home.jpeg) |
| Logout | Logged out is shown | As expected | ![image](image/05_logout_page.jpeg) |

#### ii. Role-Based Access 
| Test Case | Expected Result | Actual Result | Screenshot |
|:----------|:----------------|:--------------|:-----------|
| Admin full access | All features  accessible | As expected | ![image](image/04_admin_home.jpeg) |
| Direct URL access to unauthorized webpage (login with User) | Access denied | Redirected to result page | **Attempt:** ![image](image/46_user_unauthorized_access.jpeg) <br> **Result:** ![image](image/47_redirect_result.jpeg)|
| Direct URL access (no login) | Redirect to login | As expected | **Attempt:** ![image](image/44_direct_URL_access.jpeg) <br> **Result:** ![image](image/01_login_page.jpeg) |

#### iii. Athlete Management 

| Test Case | Expected Result | Actual Result | Screenshot |
|:----------|:----------------|:--------------|:-----------|
| View all athletes | All athletes are displayed | As expected | ![image](image/06_athlete_page.jpeg) ... (110 more lines) |
| Filter by house | Only selected house shown | As expected | ![image](image/08_athlete_filter_house.jpeg) ... (a few more lines) |
| Multiple filters | Combined filter results | As expected | ![image](image/10_athlete_multi_filter.jpeg) |
| Filter by ID | Single athlete displayed | As expected | ![image](image/09_athlete_filter_id.jpeg) |

#### iv. Event Management 

| Test Case | Expected Result | Actual Result | Screenshot |
|:----------|:----------------|:--------------|:-----------|
| View all events | 62 events displayed | As expected | ![image](image/11_event_page.jpeg) ... (52 more lines) |
| Filter by event name | Specific events shown | As expected | ![image](image/13_event_filter_name.jpeg) |
| Filter by status | Status-based filtering | As expected | ![image](image/14_event_filter_status.jpeg) ... (a few more lines) |
| Combined event filters | Multiple criteria applied | As expected | ![image](image/15_event_multi_filter.jpeg) |
| Edit event status | Status updated successfully | As expected | **Before:** ![image](image/16_event_edit_event_before.jpeg) <br> **Edit Page:** ![image](image/17_edit_event_page_before.jpeg) (Change `Not yet started` to `Completed`) <br><br> **After:** ![image](image/19_event_edit_event_after.jpeg)|

#### v. Results page

| Test Case | Expected Result | Actual Result | Screenshot |
|:----------|:----------------|:--------------|:-----------|
| View all results | Grouped by event | As expected | ![image](image/20_result_page.jpeg) ... (230 more lines) |
| Filter by athlete | Athlete's results shown | As expected | ![image](image/21_result_filter_ath.jpeg) |
| Combined result filters | Multiple criteria applied | As expected | ![image](image/22_result_multi_filter.jpeg) |
| Ranking algorithm (time) | Lower time = higher rank | As expected | ![image](image/23_result_time_based_ranking.jpeg) |
| Ranking algorithm (distance) | Higher distance = higher rank | As expected | ![image](image/24_result_distance_based_ranking.jpeg) |
| Ranking algorithm (disqualified/not yet started) | Rank shown as `-` | As expected | ![image](image/24_result_distance_based_ranking.jpeg) |
| Ranking algorithm (same result) | Ranks are the same | As expected | ![image](image/26_result_same_result.jpeg) | 

#### vi. Add/Edit/Delete Operations page

| Test Case | Expected Result | Actual Result | Screenshot |
|:----------|:----------------|:--------------|:-----------|
| Add valid result | Result added | As expected | **Before:** ![image](image/27_result_add_result_before.jpeg) <br> **Form:** ![image](image/28_add_result_page.jpeg) <br> **After:** ![image](image/29_result_add_result_after.jpeg)|
| Edit existing result | Result updated | As expected | **Before** ![image](image/36_edit_result_before.jpeg) <br> **Form:** ![image](image/37_edit_result_page.jpeg) (Change **10.25** to **30.00**) <br><br> **After:** ![image](image/38_edit_result_after.jpeg)| 
| Delete result | Result removed | As expected | **Before:** ![image](image/39_delete_result_before.jpeg) <br> **After:** ![image](image/40_delete_result_after.jpeg)|
| Invalid athlete ID| Error message | As expected | ![image](image/30_error_athlete_not_found.jpeg) |
| Gender mismatch | Error message | As expected | ![image](image/31_error_gender_or_event_mismatch.jpeg) |
| Event not started | Error message | As expected | ![image](image/32_error_event_not_started.jpeg) |
| Duplicate result | Error message | As expected | ![image](image/33_error_duplicate_result.jpeg) | 
| Invalid result value | Error message | As expected | ![image](image/35_error_invalid_result.jpeg) |

#### vii. Mobile View

| Test Case | Expected Result | Actual Result | Screenshot |
|:----------|:----------------|:--------------|:-----------|
| Mobile home | Layout same as computer | As expected | ![image](image/41_mobile_home.jpg) |
| Mobile tables | Results shown | As expected | ![image](image/43_mobile_result.jpg) |
| Mobile navigation | Hamburger menu shown| As expected | ![image](image/42_mobile_menu_open.jpg) |

### 8.4 Issues Identified

#### Issue 1: Results of Not Yet Started Events
- Description: Results of **Not yet started** events are shown in sample data
- Solution: `Null` values should be used for **Not yet started** events

#### Issue 2: Status Inconsistency for Completed Events
- Description: Some results in **Completed** events show **Not yet started** status
- Solution: **In Progress** is added as a new status for both events and athlete results

### 8.5 Future Improvement and Features 

1. Scheduling
  - `start_time` and `location` fields are added in the Events table
  - Generate a **Live Schedule** view 
  - Help athletes and helpers find ongoing events and go to correct venue

2. Athlete Performance Tracking
  - Implement a weighted scoring system 
  - An automated leaderboard to track individual performance
  - Find the **Best Athlete** in each grade

3. House Leaderboard and Ranking
  - Calculating total scores of all athletes belonging to a specific house
  - Provide a real-time **House Trophy** leaderboard
  - Foster team spirit and healthy competition across the school

4. CSV Import
  - Upload a single `.csv` file for students' information
  - No need manual entry for hundreds of students

5. Automated PDF Result Generation
  - Generate **Certificate of Achievement** PDFs for winners 
  - Generate **Final Result Sheets** for school archives

6. Real-Time Updates via WebSockets
  - Eliminate the need for manual page refresh
  - Ensure everyone sees the latest rankings immediately when a new result is added

7. Partial Name Search for Athletes
  - Improve user experience for athlete lookup

8. Mobile app connectivity
  - Push notifications to alert athletes when their event is about to start or when a result has been finalized.

## 9. Reflection
- Learn how websites in our daily life work
- Learn how to use `flask` library for building web application and `sqlite3` library for building a lightweight database to meet the needs
- Learn how web application protect sensitive user information by one-way hashing
- Learn how to make good use of AI to find errors in my code and teach me about some new knowledge


## 10. Tools and Tutorial Used

- AI Chatbot: <br> 
    i. Provide library recommendations (Faker for sample data, Werkzeug for security) and syntax guidance <br>
    ii. Generate CSS and JavaScript code for the website, and add them into HTML files <br>
    iii. Find errors and suggest fixes for them <br>
    iv. Make Python code tidier <br>
- Online HTML Beautifier: Make HTML code tidier
- [Github](github.com): Store codes and create `README.md`
- [W3Schools](www.w3schools.com): Learn HTML
- [Flask Documentation](flask.palletsprojects.com/en/stable): Learn flask framework 

